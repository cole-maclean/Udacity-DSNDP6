<!DOCTYPE html>
<meta charset="utf-8">
<style>

text {
  font: 10px sans-serif;
}

</style>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script src="http://thematicmapping.org/playground/d3/d3.slider/d3.slider.js"></script>
<script>

function get_year(){return 2015}

function get_discipline(){return 'cs'}

var dropDown = d3.select("body").append("select")
                    .attr("name", "country-list");
var options = dropDown.selectAll("option")
           .data(['cs','stats'])
         .enter()
           .append("option");
options.text(function (d) { return d.value; })
       .attr("value", function (d) { return d.value; })
dropDown.on("change", menuChanged);
function menuChanged() {
          //the name isn't important, but has to match the name
          //you added to the menu's "change" event listener.

    var selectedValue = d3.event.target.value;  
         //get the name of the selected option from the change event object

    jsonOutside.features.forEach(function (d) { 
        // loop through json data to match td entry

        if (selectedValue === d.properties.name) {
        //for each data object in the features array (d), compare it's
        //name against the one you got from the event object
        //if they match, then:

            alert(selectedValue)  //remove this line when things are working!

            click(d); // pass json element that matches selected value to click
             //which will respond the same way as if you clicked the country on
             //the map. 
        };
    })
}
//*/

var diameter = 800,
    format = d3.format(",d"),
    color = d3.scale.category20c();

var bubble = d3.layout.pack()
    .sort(null)
    .size([diameter, diameter])
    .padding(1.5)
    .value(function(d){return d.paper_count});

var svg = d3.select("body").append("svg")
    .attr("width", diameter)
    .attr("height", diameter)
    .attr("class", "bubble");


d3.json("data_model.json",draw);

function draw(root){
  year = get_year()
  discipline = get_discipline()
  var node = svg.selectAll(".node")
      .data(bubble.nodes(root[year][discipline])
      .filter(function(d) { return !d.children; }))
    .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });


  node.append("title")
      .text(function(d) {
          return d.category + ": " + format(d.paper_count);});

  node.append("circle")
      .attr("r", function(d) {
        return d.r; })
      .style("fill", function(d) {return color(d['parent_cat']); });

  node.append("text")
      .attr("dy", ".3em")
      .style("text-anchor", "middle")
      .text(function(d) { return d.paper_count; });

  var width = 0.5*diameter
  var height =diameter- 0.1*diameter

  var legend = d3.select("body").append("svg")
  .attr("class", "legend")
  .attr("width", width)
  .attr("height", height)
  .selectAll("g")
  .data(root[year][discipline]['parents'])
  .enter().append("g")
  .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

legend.append("rect")
  .attr("width", 18)
  .attr("height", 18)
  .style("fill", function(d) {return color(d); });

legend.append("text")
  .attr("x", 24)
  .attr("y", 9)
  .attr("dy", ".35em")
  .text(function(d) { return d; });

};

d3.select(self.frameElement).style("height", diameter + "px");

</script>